<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NestJS Prisma API - Interactive Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px 30px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
        padding: 40px 0;
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 30px;
      }

      .nav-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .nav-tab {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 1rem;
      }

      .nav-tab:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .nav-tab.active {
        background: rgba(255, 255, 255, 0.4);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .tab-content {
        display: none;
        background: white;
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .tab-content.active {
        display: block;
      }

      .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .section-icon {
        font-size: 2rem;
        margin-right: 15px;
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }

      .auth-icon {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      }
      .user-icon {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
      }
      .post-icon {
        background: linear-gradient(45deg, #45b7d1, #96c93d);
      }
      .category-icon {
        background: linear-gradient(45deg, #f093fb, #f5576c);
      }

      .crud-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
        margin-top: 20px;
      }

      .form-section {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
        border: 1px solid #e9ecef;
      }

      .data-section {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
        border: 1px solid #e9ecef;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
        transform: translateY(-2px);
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #1e7e34;
        transform: translateY(-2px);
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
        transform: translateY(-2px);
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
      }

      .btn-small {
        padding: 6px 12px;
        font-size: 0.875rem;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .data-table th,
      .data-table td {
        padding: 15px 12px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
      }

      .data-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
        border-top: 1px solid #dee2e6;
      }

      .data-table tr:hover {
        background: #f5f5f5;
      }

      .auth-status {
        display: inline-flex;
        align-items: center;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .auth-status.logged-in {
        background: #d4edda;
        color: #155724;
      }

      .auth-status.logged-out {
        background: #f8d7da;
        color: #721c24;
      }

      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        border: 1px solid transparent;
      }

      .alert-success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }

      .alert-error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }

      .alert-info {
        background: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
      }

      .loading {
        display: inline-block;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 20px;
        color: #dee2e6;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .tab-content {
          padding: 25px;
        }

        .form-section,
        .data-section {
          padding: 20px;
        }

        .crud-container {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .nav-tabs {
          flex-direction: column;
          align-items: center;
        }

        .data-table {
          font-size: 0.875rem;
        }

        .data-table th,
        .data-table td {
          padding: 10px 8px;
        }

        .health-status {
          padding: 25px;
        }

        .auth-required-overlay {
          padding: 25px;
          margin: 0 15px;
        }
      }

      .health-status {
        background: white;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-top: 40px;
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        padding: 12px 24px;
        background: #4caf50;
        color: white;
        border-radius: 25px;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .status-indicator i {
        margin-right: 8px;
      }

      .footer {
        text-align: center;
        color: white;
        padding: 30px 0;
        opacity: 0.8;
      }

      /* Authentication Guard Styles */
      .tab-disabled {
        opacity: 0.5;
        pointer-events: none;
        cursor: not-allowed;
      }

      .content-disabled {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
      }

      .content-disabled::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(2px);
        z-index: 10;
        border-radius: 15px;
      }

      .auth-required-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 20;
        text-align: center;
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border: 2px solid #ff6b6b;
      }

      .auth-required-overlay i {
        font-size: 3rem;
        color: #ff6b6b;
        margin-bottom: 15px;
      }

      .auth-required-overlay h3 {
        color: #ff6b6b;
        margin-bottom: 10px;
      }

      .auth-required-overlay p {
        color: #666;
        margin-bottom: 20px;
      }

      .btn-go-auth {
        background: #ff6b6b;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-go-auth:hover {
        background: #ff5252;
        transform: translateY(-2px);
      }

      /* Categories Container Styles */
      .categories-container {
        max-height: 200px;
        overflow-y: auto;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px;
        background: #f8f9fa;
      }

      .category-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        margin-bottom: 4px;
        background: white;
        border-radius: 6px;
        transition: all 0.2s ease;
        cursor: pointer;
        border: 1px solid #e9ecef;
      }

      .category-item:hover {
        background: #e3f2fd;
        border-color: #2196f3;
      }

      .category-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
        accent-color: #007bff;
        width: 16px;
        height: 16px;
      }

      .category-item label {
        margin: 0;
        cursor: pointer;
        flex: 1;
        font-weight: 500;
      }

      .category-item.selected {
        background: #e7f3ff;
        border-color: #007bff;
      }

      .categories-container::-webkit-scrollbar {
        width: 6px;
      }

      .categories-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }

      .categories-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
      }

      .categories-container::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-rocket"></i> NestJS Prisma API</h1>
        <p>Interactive Dashboard - Full CRUD Operations</p>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('auth')">
          <i class="fas fa-shield-alt"></i> Authentication
        </button>
        <button class="nav-tab" id="usersTab" onclick="showTab('users')">
          <i class="fas fa-users"></i> Users
        </button>
        <button class="nav-tab" id="postsTab" onclick="showTab('posts')">
          <i class="fas fa-file-alt"></i> Posts
        </button>
        <button class="nav-tab" id="categoriesTab" onclick="showTab('categories')">
          <i class="fas fa-tags"></i> Categories
        </button>
      </div>

      <!-- Authentication Tab -->
      <div id="auth" class="tab-content active">
        <div class="section-header">
          <div class="section-icon auth-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div>
            <h2>Authentication</h2>
            <p>Register new users and login to get access tokens</p>
          </div>
        </div>

        <div id="authStatus" class="auth-status logged-out">
          <i class="fas fa-user-slash"></i> Not Authenticated
        </div>

        <div class="crud-container">
          <div class="form-section">
            <h3>Login / Register</h3>
            <div id="authForm">
              <div class="form-group">
                <label>Mode:</label>
                <select id="authMode" onchange="toggleAuthMode()">
                  <option value="login">Login</option>
                  <option value="register">Register</option>
                </select>
              </div>

              <div class="form-group" id="nameGroup" style="display: none">
                <label>Name:</label>
                <input
                  type="text"
                  id="authName"
                  placeholder="Enter your name"
                />
              </div>

              <div class="form-group" id="phoneGroup" style="display: none">
                <label>Phone:</label>
                <input
                  type="text"
                  id="authPhone"
                  placeholder="Enter phone number"
                />
              </div>

              <div class="form-group">
                <label>Email:</label>
                <input
                  type="email"
                  id="authEmail"
                  placeholder="Enter your email"
                />
              </div>

              <div class="form-group">
                <label>Password:</label>
                <input
                  type="password"
                  id="authPassword"
                  placeholder="Enter your password"
                />
              </div>

              <button class="btn btn-primary" onclick="handleAuth()">
                <i class="fas fa-sign-in-alt"></i> Login
              </button>
              <button
                class="btn btn-warning"
                onclick="logout()"
                id="logoutBtn"
                style="display: none"
              >
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </div>

          <div class="data-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h3>Authentication Info</h3>
              <button class="btn btn-primary btn-small" onclick="refreshUserInfo()" id="refreshUserBtn" style="display: none;">
                <i class="fas fa-refresh"></i> Refresh
              </button>
            </div>
            <div id="authInfo">
              <div class="empty-state">
                <i class="fas fa-user-lock"></i>
                <p>Please login to see authentication information</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="users" class="tab-content">
        <div class="section-header">
          <div class="section-icon user-icon">
            <i class="fas fa-users"></i>
          </div>
          <div>
            <h2>Users Management</h2>
            <p>Create, read, update, and delete users</p>
          </div>
        </div>

        <!-- Authentication Required Overlay -->
        <div id="usersAuthOverlay" class="auth-required-overlay" style="display: none;">
          <i class="fas fa-lock"></i>
          <h3>Authentication Required</h3>
          <p>Please login to access Users Management</p>
          <button class="btn-go-auth" onclick="showTab('auth')">
            <i class="fas fa-sign-in-alt"></i> Go to Login
          </button>
        </div>

        <div class="crud-container" id="usersContent">
          <div class="form-section">
            <h3 id="userFormTitle">Create User</h3>
            <form id="userForm">
              <input type="hidden" id="userId" />

              <div class="form-group">
                <label>Name:</label>
                <input
                  type="text"
                  id="userName"
                  placeholder="Enter user name"
                  required
                />
              </div>

              <div class="form-group">
                <label>Phone:</label>
                <input
                  type="text"
                  id="userPhone"
                  placeholder="Enter phone number"
                  required
                />
              </div>

              <div class="form-group">
                <label>Email:</label>
                <input
                  type="email"
                  id="userEmail"
                  placeholder="Enter email address"
                  required
                />
              </div>

              <div class="form-group" id="passwordGroup">
                <label>Password:</label>
                <input
                  type="password"
                  id="userPassword"
                  placeholder="Enter password"
                  required
                />
              </div>

              <div class="form-group">
                <label>Status:</label>
                <select id="userStatus">
                  <option value="1">Active</option>
                  <option value="0">Inactive</option>
                </select>
              </div>

              <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Save User
              </button>
              <button
                type="button"
                class="btn btn-warning"
                onclick="resetUserForm()"
              >
                <i class="fas fa-undo"></i> Reset
              </button>
            </form>
          </div>

          <div class="data-section">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h3>Users List</h3>
              <button class="btn btn-primary" onclick="loadUsers()">
                <i class="fas fa-refresh"></i> Refresh
              </button>
            </div>
            <div id="usersData">
              <div class="empty-state">
                <i class="fas fa-users"></i>
                <p>Click refresh to load users</p>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

      <!-- Posts Tab -->
      <div id="posts" class="tab-content">
        <div class="section-header">
          <div class="section-icon post-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <div>
            <h2>Posts Management</h2>
            <p>Create, read, update posts with categories</p>
          </div>
        </div>

        <!-- Authentication Required Overlay -->
        <div id="postsAuthOverlay" class="auth-required-overlay" style="display: none;">
          <i class="fas fa-lock"></i>
          <h3>Authentication Required</h3>
          <p>Please login to access Posts Management</p>
          <button class="btn-go-auth" onclick="showTab('auth')">
            <i class="fas fa-sign-in-alt"></i> Go to Login
          </button>
        </div>

        <div class="crud-container" id="postsContent">
          <div class="form-section">
            <h3 id="postFormTitle">Create Post</h3>
            <form id="postForm">
              <input type="hidden" id="postId" />

              <div class="form-group">
                <label>Title:</label>
                <input
                  type="text"
                  id="postTitle"
                  placeholder="Enter post title"
                  required
                />
              </div>

              <div class="form-group">
                <label>Summary:</label>
                <textarea
                  id="postSummary"
                  placeholder="Enter post summary"
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label>Content:</label>
                <textarea
                  id="postContent"
                  placeholder="Enter post content"
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label>Owner:</label>
                <select id="postOwnerId" required>
                  <option value="">Select an owner</option>
                  <!-- Users will be loaded dynamically -->
                </select>
              </div>

              <div class="form-group">
                <label>Categories:</label>
                <div id="postCategories" class="categories-container">
                  <!-- Categories will be loaded dynamically -->
                </div>
              </div>

              <div class="form-group">
                <label>Status:</label>
                <select id="postStatus">
                  <option value="1">Published</option>
                  <option value="0">Draft</option>
                </select>
              </div>

              <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Save Post
              </button>
              <button
                type="button"
                class="btn btn-warning"
                onclick="resetPostForm()"
              >
                <i class="fas fa-undo"></i> Reset
              </button>
            </form>
          </div>

          <div class="data-section">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h3>Posts List</h3>
              <button class="btn btn-primary" onclick="loadPosts()">
                <i class="fas fa-refresh"></i> Refresh
              </button>
            </div>
            <div id="postsData">
              <div class="empty-state">
                <i class="fas fa-file-alt"></i>
                <p>Click refresh to load posts</p>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

      <!-- Categories Tab -->
      <div id="categories" class="tab-content">
        <div class="section-header">
          <div class="section-icon category-icon">
            <i class="fas fa-tags"></i>
          </div>
          <div>
            <h2>Categories Management</h2>
            <p>Create, read, update, and delete categories</p>
          </div>
        </div>

        <!-- Authentication Required Overlay -->
        <div id="categoriesAuthOverlay" class="auth-required-overlay" style="display: none;">
          <i class="fas fa-lock"></i>
          <h3>Authentication Required</h3>
          <p>Please login to access Categories Management</p>
          <button class="btn-go-auth" onclick="showTab('auth')">
            <i class="fas fa-sign-in-alt"></i> Go to Login
          </button>
        </div>

        <div class="crud-container" id="categoriesContent">
          <div class="form-section">
            <h3 id="categoryFormTitle">Create Category</h3>
            <form id="categoryForm">
              <input type="hidden" id="categoryId" />

              <div class="form-group">
                <label>Name:</label>
                <input
                  type="text"
                  id="categoryName"
                  placeholder="Enter category name"
                  required
                />
              </div>

              <div class="form-group">
                <label>Description:</label>
                <textarea
                  id="categoryDescription"
                  placeholder="Enter category description"
                  required
                ></textarea>
              </div>

              <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Save Category
              </button>
              <button
                type="button"
                class="btn btn-warning"
                onclick="resetCategoryForm()"
              >
                <i class="fas fa-undo"></i> Reset
              </button>
            </form>
          </div>

          <div class="data-section">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h3>Categories List</h3>
              <button class="btn btn-primary" onclick="loadCategories()">
                <i class="fas fa-refresh"></i> Refresh
              </button>
            </div>
            <div id="categoriesData">
              <div class="empty-state">
                <i class="fas fa-tags"></i>
                <p>Click refresh to load categories</p>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

      <!-- Health Status -->
      <div class="health-status">
        <div class="status-indicator loading" id="statusIndicator">
          <i class="fas fa-circle"></i>
          Checking API Status...
        </div>
        <h3>API Health Status</h3>
        <p>Real-time monitoring of your API health and uptime</p>
        <div
          id="healthInfo"
          style="
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            color: #666;
          "
        ></div>
      </div>

      <div class="footer">
        <p>
          &copy; 2025 NestJS Prisma API. Built with ❤️ using NestJS, Prisma, and
          PostgreSQL.
        </p>
      </div>
    </div>

    <!-- Alert Container -->
    <div
      id="alertContainer"
      style="position: fixed; top: 20px; right: 20px; z-index: 1000"
    ></div>

    <script>
      // Global state
      let authToken = localStorage.getItem('authToken') || null;
      let currentUser = JSON.parse(
        localStorage.getItem('currentUser') || 'null',
      );

      // Initialize the page
      document.addEventListener('DOMContentLoaded', function () {
        initializeApp();
        checkHealth();
        setInterval(checkHealth, 30000);
      });

      // Initialize application
      async function initializeApp() {
        // If user has token, try to load their info
        if (authToken) {
          await loadCurrentUserInfo();
        }
        updateAuthStatus();
        updateAuthGuards();
      }

      // Load current user information from API
      async function loadCurrentUserInfo() {
        try {
          const userInfo = await apiCall('/users/me');
          currentUser = userInfo;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
        } catch (error) {
          console.error('Failed to load user info:', error);
          // If API call fails, clear invalid token
          logout();
        }
      }

      // Refresh user information manually
      async function refreshUserInfo() {
        if (!authToken) {
          showAlert('Please login first', 'error');
          return;
        }

        try {
          await loadCurrentUserInfo();
          updateAuthStatus();
        } catch (error) {
          showAlert('Failed to refresh user information', 'error');
        }
      }

      // Copy token to clipboard
      async function copyTokenToClipboard() {
        if (!authToken) {
          showAlert('No token available to copy', 'error');
          return;
        }

        try {
          await navigator.clipboard.writeText(authToken);
          showAlert('Token copied to clipboard successfully!', 'success');
        } catch (error) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = authToken;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showAlert('Token copied to clipboard successfully!', 'success');
        }
      }

      // Authentication Guard Functions
      function updateAuthGuards() {
        const isAuthenticated = authToken !== null;
        const protectedTabs = ['users', 'posts', 'categories'];
        
        protectedTabs.forEach(tabName => {
          const tab = document.getElementById(`${tabName}Tab`);
          const content = document.getElementById(`${tabName}Content`);
          const overlay = document.getElementById(`${tabName}AuthOverlay`);
          
          if (isAuthenticated) {
            // Enable tab and content
            tab.classList.remove('tab-disabled');
            content.classList.remove('content-disabled');
            overlay.style.display = 'none';
          } else {
            // Disable tab and content
            tab.classList.add('tab-disabled');
            content.classList.add('content-disabled');
            overlay.style.display = 'block';
          }
        });
      }

      function checkAuthBeforeTabSwitch(tabName) {
        const protectedTabs = ['users', 'posts', 'categories'];
        
        if (protectedTabs.includes(tabName) && !authToken) {
          showAlert('Please login first to access this section', 'error');
          return false;
        }
        return true;
      }

      // Utility Functions
      function showAlert(message, type = 'info') {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = `
          <span>${message}</span>
        `;
        alertContainer.appendChild(alert);

        setTimeout(() => {
          if (alert.parentElement) {
            alert.remove();
          }
        }, 3000);
      }

      async function apiCall(endpoint, options = {}) {
        const baseUrl = 'http://localhost:3000';
        const url = `${baseUrl}${endpoint}`;

        const defaultOptions = {
          headers: {
            'Content-Type': 'application/json',
          },
        };

        if (authToken) {
          defaultOptions.headers['Authorization'] = `Bearer ${authToken}`;
        }

        const mergedOptions = {
          ...defaultOptions,
          ...options,
          headers: {
            ...defaultOptions.headers,
            ...options.headers,
          },
        };

        try {
          const response = await fetch(url, mergedOptions);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || `HTTP ${response.status}`);
          }

          return data;
        } catch (error) {
          console.error('API call failed:', error);
          throw error;
        }
      }

      // Tab Navigation
      function showTab(tabName) {
        // Check authentication for protected tabs
        if (!checkAuthBeforeTabSwitch(tabName)) {
          return;
        }

        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach((tab) => {
          tab.classList.remove('active');
        });

        // Remove active from all nav tabs
        document.querySelectorAll('.nav-tab').forEach((navTab) => {
          navTab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName).classList.add('active');

        // Add active to clicked nav tab
        event.target.classList.add('active');

        // Load data for the selected tab
        if (tabName === 'users') {
          loadUsers();
        } else if (tabName === 'posts') {
          loadPosts();
          loadCategoriesForSelect();
          loadUsersForSelect();
        } else if (tabName === 'categories') {
          loadCategories();
        }
      }

      // Authentication Functions
      function updateAuthStatus() {
        const authStatus = document.getElementById('authStatus');
        const logoutBtn = document.getElementById('logoutBtn');
        const refreshUserBtn = document.getElementById('refreshUserBtn');
        const authInfo = document.getElementById('authInfo');

        if (authToken && currentUser) {
          authStatus.className = 'auth-status logged-in';
          authStatus.innerHTML =
            '<i class="fas fa-user-check"></i> Authenticated';
          logoutBtn.style.display = 'inline-block';
          refreshUserBtn.style.display = 'inline-block';

          authInfo.innerHTML = `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <h4>Current User</h4>
              <p><strong>Name:</strong> ${currentUser.name || 'N/A'}</p>
              <p><strong>Email:</strong> ${currentUser.email || 'N/A'}</p>
              <p><strong>Phone:</strong> ${currentUser.phone || 'N/A'}</p>
              <p><strong>ID:</strong> ${currentUser.id || 'N/A'}</p>
              <p><strong>Status:</strong> ${currentUser.status === 1 ? 'Active' : 'Inactive'}</p>
              <p><strong>Created:</strong> ${currentUser.createdAt ? new Date(currentUser.createdAt).toLocaleDateString() : 'N/A'}</p>
              <p><strong>Updated:</strong> ${currentUser.updatedAt ? new Date(currentUser.updatedAt).toLocaleDateString() : 'N/A'}</p>
              <div style="margin-top: 15px; font-family: 'Courier New', monospace; font-size: 0.9rem; background: #e9ecef; padding: 10px; border-radius: 4px; word-break: break-all; position: relative;">
                <strong>Token:</strong> ${authToken.substring(0, 50)}...
                <button 
                  onclick="copyTokenToClipboard()" 
                  style="position: absolute; top: 8px; right: 8px; background: #007bff; color: white; border: none; border-radius: 4px; padding: 6px 8px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s ease;"
                  onmouseover="this.style.background='#0056b3'"
                  onmouseout="this.style.background='#007bff'"
                  title="Copy token to clipboard"
                >
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
          `;
        } else {
          authStatus.className = 'auth-status logged-out';
          authStatus.innerHTML =
            '<i class="fas fa-user-slash"></i> Not Authenticated';
          logoutBtn.style.display = 'none';
          refreshUserBtn.style.display = 'none';

          authInfo.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-user-lock"></i>
              <p>Please login to see authentication information</p>
            </div>
          `;
        }
        
        // Update authentication guards
        updateAuthGuards();
      }

      function toggleAuthMode() {
        const mode = document.getElementById('authMode').value;
        const nameGroup = document.getElementById('nameGroup');
        const phoneGroup = document.getElementById('phoneGroup');
        const submitBtn = document.querySelector('#authForm .btn-primary');

        if (mode === 'register') {
          nameGroup.style.display = 'block';
          phoneGroup.style.display = 'block';
          submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Register';
        } else {
          nameGroup.style.display = 'none';
          phoneGroup.style.display = 'none';
          submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
        }
      }

      async function handleAuth() {
        const mode = document.getElementById('authMode').value;
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;

        if (!email || !password) {
          showAlert('Please fill in all required fields', 'error');
          return;
        }

        try {
          let endpoint, data;

          if (mode === 'register') {
            const name = document.getElementById('authName').value;
            const phone = document.getElementById('authPhone').value;

            if (!name || !phone) {
              showAlert(
                'Please fill in all required fields for registration',
                'error',
              );
              return;
            }

            endpoint = '/auth/register';
            data = { name, phone, email, password, status: 1 };

            const result = await apiCall(endpoint, {
              method: 'POST',
              body: JSON.stringify(data),
            });

            document.getElementById('authMode').value = 'login';
            toggleAuthMode();
          } else {
            endpoint = '/auth/login';
            data = { email, password };

            const result = await apiCall(endpoint, {
              method: 'POST',
              body: JSON.stringify(data),
            });

            authToken = result.accessToken;
            localStorage.setItem('authToken', authToken);

            // Load current user info from API
            await loadCurrentUserInfo();
            
            updateAuthStatus();
          }

          // Clear form
          document.getElementById('authEmail').value = '';
          document.getElementById('authPassword').value = '';
          document.getElementById('authName').value = '';
          document.getElementById('authPhone').value = '';
        } catch (error) {
          showAlert(`Authentication failed: ${error.message}`, 'error');
        }
      }

      function logout() {
        authToken = null;
        currentUser = null;
        localStorage.removeItem('authToken');
        localStorage.removeItem('currentUser');
        updateAuthStatus();
      }

      // Users Management
      async function loadUsers() {
        try {
          const result = await apiCall('/users');
          displayUsers(result.data || result);
        } catch (error) {
          showAlert(`Failed to load users: ${error.message}`, 'error');
          document.getElementById('usersData').innerHTML = `
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Failed to load users. Please check authentication.</p>
            </div>
          `;
        }
      }

      function displayUsers(users) {
        const container = document.getElementById('usersData');

        if (!users || users.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-users"></i>
              <p>No users found</p>
            </div>
          `;
          return;
        }

        let table = `
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        users.forEach((user) => {
          table += `
            <tr>
              <td>${user.id}</td>
              <td>${user.name || 'N/A'}</td>
              <td>${user.email}</td>
              <td>${user.phone || 'N/A'}</td>
              <td>${user.status === 1 ? 'Active' : 'Inactive'}</td>
              <td>
                <button class="btn btn-warning btn-small" onclick="editUser(${user.id})">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-small" onclick="deleteUser(${user.id})">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </td>
            </tr>
          `;
        });

        table += '</tbody></table>';
        container.innerHTML = table;
      }

      async function editUser(id) {
        try {
          const user = await apiCall(`/users/${id}`);

          document.getElementById('userId').value = user.id;
          document.getElementById('userName').value = user.name || '';
          document.getElementById('userPhone').value = user.phone || '';
          document.getElementById('userEmail').value = user.email;
          document.getElementById('userStatus').value = user.status;

          // Hide password field for editing
          document.getElementById('passwordGroup').style.display = 'none';
          document.getElementById('userPassword').required = false;

          document.getElementById('userFormTitle').textContent = 'Edit User';
        } catch (error) {
          showAlert(`Failed to load user: ${error.message}`, 'error');
        }
      }

      async function deleteUser(id) {
        if (!confirm('Are you sure you want to delete this user?')) {
          return;
        }

        try {
          await apiCall(`/users/${id}`, { method: 'DELETE' });
          loadUsers();
        } catch (error) {
          showAlert(`Failed to delete user: ${error.message}`, 'error');
        }
      }

      function resetUserForm() {
        document.getElementById('userForm').reset();
        document.getElementById('userId').value = '';
        document.getElementById('userFormTitle').textContent = 'Create User';
        document.getElementById('passwordGroup').style.display = 'block';
        document.getElementById('userPassword').required = true;
      }

      // User form submission
      document
        .getElementById('userForm')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const userId = document.getElementById('userId').value;
          const name = document.getElementById('userName').value;
          const phone = document.getElementById('userPhone').value;
          const email = document.getElementById('userEmail').value;
          const password = document.getElementById('userPassword').value;
          const status = parseInt(document.getElementById('userStatus').value);

          const data = { name, phone, email, status };

          if (!userId) {
            data.password = password;
          }

          try {
            if (userId) {
              // Update user
              await apiCall(`/users/${userId}`, {
                method: 'PUT',
                body: JSON.stringify(data),
              });
            } else {
              // Create user
              await apiCall('/users', {
                method: 'POST',
                body: JSON.stringify(data),
              });
            }

            resetUserForm();
            loadUsers();
          } catch (error) {
            showAlert(`Failed to save user: ${error.message}`, 'error');
          }
        });

      // Categories Management
      async function loadCategories() {
        try {
          const result = await apiCall('/categories');
          displayCategories(result.data || result);
        } catch (error) {
          showAlert(`Failed to load categories: ${error.message}`, 'error');
          document.getElementById('categoriesData').innerHTML = `
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Failed to load categories. Please check authentication.</p>
            </div>
          `;
        }
      }

      function displayCategories(categories) {
        const container = document.getElementById('categoriesData');

        if (!categories || categories.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-tags"></i>
              <p>No categories found</p>
            </div>
          `;
          return;
        }

        let table = `
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        categories.forEach((category) => {
          table += `
            <tr>
              <td>${category.id}</td>
              <td>${category.name}</td>
              <td>${category.description}</td>
              <td>
                <button class="btn btn-warning btn-small" onclick="editCategory(${category.id})">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-small" onclick="deleteCategory(${category.id})">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </td>
            </tr>
          `;
        });

        table += '</tbody></table>';
        container.innerHTML = table;
      }

      async function editCategory(id) {
        try {
          const category = await apiCall(`/categories/${id}`);

          document.getElementById('categoryId').value = category.id;
          document.getElementById('categoryName').value = category.name;
          document.getElementById('categoryDescription').value =
            category.description;

          document.getElementById('categoryFormTitle').textContent =
            'Edit Category';
        } catch (error) {
          showAlert(`Failed to load category: ${error.message}`, 'error');
        }
      }

      async function deleteCategory(id) {
        if (!confirm('Are you sure you want to delete this category?')) {
          return;
        }

        try {
          await apiCall(`/categories/${id}`, { method: 'DELETE' });
          loadCategories();
        } catch (error) {
          showAlert(`Failed to delete category: ${error.message}`, 'error');
        }
      }

      function resetCategoryForm() {
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryId').value = '';
        document.getElementById('categoryFormTitle').textContent =
          'Create Category';
      }

      // Category form submission
      document
        .getElementById('categoryForm')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const categoryId = document.getElementById('categoryId').value;
          const name = document.getElementById('categoryName').value;
          const description = document.getElementById(
            'categoryDescription',
          ).value;

          const data = { name, description };

          try {
            if (categoryId) {
              // Update category
            await apiCall(`/categories/${categoryId}`, {
              method: 'PUT',
              body: JSON.stringify(data),
            });
          } else {
            // Create category
            await apiCall('/categories', {
              method: 'POST',
              body: JSON.stringify(data),
            });
          }            resetCategoryForm();
            loadCategories();
          } catch (error) {
            showAlert(`Failed to save category: ${error.message}`, 'error');
          }
        });

      // Posts Management
      async function loadUsersForSelect() {
        try {
          const result = await apiCall('/users');
          console.log("Loaded users for select:", result);
          const users = result.data || result;
          const select = document.getElementById('postOwnerId');

          // Keep the default option and clear other options
          select.innerHTML = '<option value="">Select an owner</option>';
          
          users.forEach((user) => {
            const option = document.createElement('option');
            option.value = user.id;
            option.textContent = `${user.name || 'Unknown'} (ID: ${user.id})`;
            select.appendChild(option);
          });
        } catch (error) {
          console.error('Failed to load users for select:', error);
          showAlert('Failed to load users for owner selection', 'error');
        }
      }

      async function loadCategoriesForSelect() {
        try {
          const result = await apiCall('/categories');
          const categories = result.data || result;
          const container = document.getElementById('postCategories');

          container.innerHTML = '';
          
          if (categories.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No categories available</p>';
            return;
          }

          categories.forEach((category) => {
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            categoryItem.onclick = function() {
              const checkbox = this.querySelector('input[type="checkbox"]');
              checkbox.checked = !checkbox.checked;
              this.classList.toggle('selected', checkbox.checked);
            };

            categoryItem.innerHTML = `
              <input type="checkbox" id="category_${category.id}" value="${category.id}" onclick="event.stopPropagation(); this.parentElement.classList.toggle('selected', this.checked);">
              <label for="category_${category.id}">${category.name}</label>
            `;

            container.appendChild(categoryItem);
          });
        } catch (error) {
          console.error('Failed to load categories for select:', error);
          showAlert('Failed to load categories', 'error');
        }
      }

      async function loadPosts() {
        try {
          const result = await apiCall('/posts');
          displayPosts(result.data || result);
        } catch (error) {
          showAlert(`Failed to load posts: ${error.message}`, 'error');
          document.getElementById('postsData').innerHTML = `
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Failed to load posts. Please check authentication.</p>
            </div>
          `;
        }
      }

      function displayPosts(posts) {
        const container = document.getElementById('postsData');

        if (!posts || posts.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-file-alt"></i>
              <p>No posts found</p>
            </div>
          `;
          return;
        }

        let table = `
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Summary</th>
                <th>Status</th>
                <th>Owner</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        posts.forEach((post) => {
          table += `
            <tr>
              <td>${post.id}</td>
              <td>${post.title}</td>
              <td>${post.summary?.substring(0, 50)}...</td>
              <td>${post.status === 1 ? 'Published' : 'Draft'}</td>
              <td>${post.ownerId}</td>
              <td>
                <button class="btn btn-warning btn-small" onclick="editPost(${post.id})">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-small" onclick="deletePost(${post.id})">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </td>
            </tr>
          `;
        });

        table += '</tbody></table>';
        container.innerHTML = table;
      }

      async function editPost(id) {
        try {
          const post = await apiCall(`/posts/${id}`);

          document.getElementById('postId').value = post.id;
          document.getElementById('postTitle').value = post.title;
          document.getElementById('postSummary').value = post.summary;
          document.getElementById('postContent').value = post.content;
          document.getElementById('postOwnerId').value = post.ownerId;
          document.getElementById('postStatus').value = post.status;

          // Handle categories if available
          if (post.categories) {
            const container = document.getElementById('postCategories');
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            
            checkboxes.forEach((checkbox) => {
              const isSelected = post.categories.some(
                (cat) => cat.id == checkbox.value,
              );
              checkbox.checked = isSelected;
              checkbox.parentElement.classList.toggle('selected', isSelected);
            });
          }

          document.getElementById('postFormTitle').textContent = 'Edit Post';
        } catch (error) {
          showAlert(`Failed to load post: ${error.message}`, 'error');
        }
      }

      async function deletePost(id) {
        if (!confirm('Are you sure you want to delete this post?')) {
          return;
        }

        try {
          await apiCall(`/posts/${id}`, { method: 'DELETE' });
          loadPosts();
        } catch (error) {
          showAlert(`Failed to delete post: ${error.message}`, 'error');
        }
      }

      function resetPostForm() {
        document.getElementById('postForm').reset();
        document.getElementById('postId').value = '';
        document.getElementById('postFormTitle').textContent = 'Create Post';
        loadUsersForSelect();
      }

      // Post form submission
      document
        .getElementById('postForm')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const postId = document.getElementById('postId').value;
          const title = document.getElementById('postTitle').value;
          const summary = document.getElementById('postSummary').value;
          const content = document.getElementById('postContent').value;
          const ownerId = parseInt(
            document.getElementById('postOwnerId').value,
          );
          const status = parseInt(document.getElementById('postStatus').value);

          const categoryContainer = document.getElementById('postCategories');
          const categoryIds = Array.from(categoryContainer.querySelectorAll('input[type="checkbox"]:checked')).map(
            (checkbox) => parseInt(checkbox.value),
          );

          const data = {
            title,
            summary,
            content,
            ownerId,
            status,
            categoryIds,
          };

          try {
            if (postId) {
            // Update post
            await apiCall(`/posts/${postId}`, {
              method: 'PUT',
              body: JSON.stringify(data),
            });
          } else {
            // Create post
            await apiCall('/posts', {
              method: 'POST',
              body: JSON.stringify(data),
            });
          }            resetPostForm();
            loadPosts();
          } catch (error) {
            showAlert(`Failed to save post: ${error.message}`, 'error');
          }
        });

      // Health Check
      async function checkHealth() {
        try {
          const response = await fetch('http://localhost:3000/health-check');
          const data = await response.json();

          const indicator = document.getElementById('statusIndicator');
          const healthInfo = document.getElementById('healthInfo');

          if (response.ok) {
            indicator.className = 'status-indicator';
            indicator.style.background = '#4CAF50';
            indicator.innerHTML =
              '<i class="fas fa-check-circle"></i> API is Online';

            healthInfo.innerHTML = `
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; display: inline-block;">
                <div><strong>Uptime:</strong> ${Math.floor(data.uptime)} seconds</div>
                <div><strong>Last Check:</strong> ${new Date(data.date).toLocaleString()}</div>
              </div>
            `;
          } else {
            throw new Error('Health check failed');
          }
        } catch (error) {
          const indicator = document.getElementById('statusIndicator');
          indicator.className = 'status-indicator';
          indicator.style.background = '#f93e3e';
          indicator.innerHTML =
            '<i class="fas fa-exclamation-circle"></i> API is Offline';

          document.getElementById('healthInfo').innerHTML = `
            <div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; display: inline-block;">
              Unable to connect to API. Please check if the server is running.
            </div>
          `;
        }
      }
    </script>
  </body>
</html>
